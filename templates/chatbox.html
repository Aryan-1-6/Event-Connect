{% extends "base.html" %}

{% block title %}Chat - Your App Name{% endblock %}

{% block content %}
<style>
    .username-container {
        text-align: left;
        padding: 10px;
        background-color: #0084ff; /* Blue background color */
        border-radius: 10px;
        margin-bottom: 20px;    }

    .username-label {
        text-align: right;
        font-size: 14px;
        font-weight: bold;
        color: #fff; /* White color */
        margin-bottom: 5px;
    }

    .username-value {
        font-size: 24px;
        font-weight: bold;
        color: #fff; /* White color */
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .chat-container {
        max-width: 500px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .message-bubble {
        max-width: 70%;
        margin-bottom: 10px;
        padding: 10px 15px;
        border-radius: 20px;
        clear: both;
    }

    .message-sender {
        font-weight: bold;
        color: #999; 
        font-size: 14px;
        margin-bottom: 5px;
    }

    .message-container {
        overflow-y: scroll;
        max-height: 400px;
    }

    .my-message {
        background-color: #e6e318;
        float: right;
        color: #000;
    }

    .their-message {
        background-color: #e6e318;
        float: left;
        color: #000;
    }

    .chat-form {
        margin-top: 20px;
    }

    .chat-form input[type="text"] {
        width: calc(100% - 80px);
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 20px;
        outline: none;
    }

    .chat-form button {
        width: 70px;
        padding: 10px;
        border: none;
        border-radius: 20px;
        background-color: #0084ff;
        color: #fff;
        cursor: pointer;
    }
</style>

<div class="chat-container">
    <div class="username-container">
        <div class="username-value">{{ Name }}</div>
        <div class="username-label">{{ role }}</div>
    </div>
    <div class="message-container" id="message-container">

    </div>

    <form id="message-form" class="chat-form">
        
        <input type="text" id="message" placeholder="Type your message...">
        <button type="submit">Send</button>
    </form>
</div>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.2.0/socket.io.js"></script>

<script type="text/javascript">
    $(document).ready(function(){
        var socket = io.connect('http://' + document.domain + ':' + location.port);

        socket.on('connect', function() {
            socket.emit('my event', {data: 'User Connected'});
            
            $('#message-form').submit(function(e) {
                e.preventDefault();
                var username = "{{ myname }}";
                var senderid = "{{ user_id }}";
                var receiverid = "{{ receiver_id }}";
                var boxid = "{{ box_id }}"
                var message = $('#message').val();
                socket.emit('my event', {
                    user_name: username,
                    sender_id: senderid,
                    receiver_id: receiverid,
                    message: message,
                    box_id: boxid
                });
                $('#message').val('').focus();
            });
        });

        socket.on('my response', function(msg) {
            if (typeof msg.user_name !== 'undefined') {
                var messageClass = (msg.user_name == $('#username').val()) ? 'my-message' : 'their-message';
                $('#message-container').append('<div class="message-bubble ' + messageClass + '"><div class="message-sender">' + msg.user_name + '</div>' + msg.message + '</div>');
                $('#message-container').scrollTop($('#message-container')[0].scrollHeight);
            }
        });
    });
</script>

{% endblock %}
